# ğŸ“± æ‰‹æœºè¿œç¨‹ SSH è¿æ¥ Mac ç”µè„‘å®Œæ•´æ•™ç¨‹

> ä½¿ç”¨ Tailscale å®ç°å¼‚åœ°ç»„ç½‘ï¼Œæ— éœ€å…¬ç½‘ IPï¼Œå®‰å…¨å¯é 

---

## ğŸ“‹ ç›®å½•

- [åŸç†ç®€ä»‹](#åŸç†ç®€ä»‹)
- [ç”µè„‘ç«¯é…ç½®](#ç”µè„‘ç«¯é…ç½®)
- [æ‰‹æœºç«¯é…ç½®](#æ‰‹æœºç«¯é…ç½®)
- [SSH è¿æ¥](#ssh-è¿æ¥)
- [è¿›é˜¶ï¼šé…ç½® Exit Node](#è¿›é˜¶é…ç½®-exit-node)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## åŸç†ç®€ä»‹

Tailscale åŸºäº WireGuard åè®®ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVPNï¼‰ï¼Œè®©ä½ çš„è®¾å¤‡å³ä½¿åœ¨ä¸åŒç½‘ç»œä¸‹ä¹Ÿèƒ½åƒåœ¨åŒä¸€å±€åŸŸç½‘å†…é€šä¿¡ã€‚

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- âœ… æ— éœ€å…¬ç½‘ IPï¼Œæ— éœ€ç«¯å£è½¬å‘
- âœ… ç«¯åˆ°ç«¯åŠ å¯†ï¼Œå®‰å…¨å¯é 
- âœ… P2P ç›´è¿ä¼˜å…ˆï¼Œå»¶è¿Ÿä½
- âœ… æ”¯æŒ iOSã€Androidã€macOSã€Windowsã€Linux

```
æ‰‹æœº (4G/5G) â”€â”€â”€â–º Tailscale ç½‘ç»œ â”€â”€â”€â–º å®¶é‡Œç”µè„‘
      â”‚                                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ WireGuard éš§é“ â”€â”€â”€â”€â”€â”€â”˜
              (ç«¯åˆ°ç«¯åŠ å¯†)
```

---

## ç”µè„‘ç«¯é…ç½®

### 1. å®‰è£… Tailscale

```bash
# macOS (ä½¿ç”¨ Homebrew)
brew install tailscale

# æˆ–ä½¿ç”¨å®˜æ–¹å®‰è£…åŒ…
# https://tailscale.com/download
```

### 2. å¯åŠ¨å¹¶ç™»å½•

```bash
# å¯åŠ¨ç³»ç»ŸæœåŠ¡ï¼ˆéœ€è¦å¯†ç ï¼‰
sudo tailscaled install-system-daemon

# ç™»å½•ï¼ˆä¼šå¼¹å‡ºæµè§ˆå™¨è®¤è¯ï¼‰
tailscale up

# æŸ¥çœ‹åˆ†é…åˆ°çš„ IP
tailscale ip -4
# è¾“å‡ºç¤ºä¾‹ï¼š100.x.x.x
```

### 3. å¼€å¯ macOS è¿œç¨‹ç™»å½•ï¼ˆSSHï¼‰

**æ–¹æ³• A - å›¾å½¢ç•Œé¢ï¼š**
```
ç³»ç»Ÿè®¾ç½® â†’ é€šç”¨ â†’ å…±äº« â†’ è¿œç¨‹ç™»å½• â†’ å¼€å¯
```

**æ–¹æ³• B - ç»ˆç«¯ï¼š**
```bash
sudo systemsetup -setremotelogin on
```

**éªŒè¯ SSH æ˜¯å¦å·¥ä½œï¼š**
```bash
ssh localhost
# è¾“å…¥å¯†ç åèƒ½ç™»å½•å³æˆåŠŸ
```

### 4. è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
brew install pm2

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > ~/tailscale-keeper.sh << 'EOF'
#!/bin/bash
while true; do
    if ! tailscale status &>/dev/null; then
        tailscale up --accept-routes
    fi
    sleep 60
done
EOF
chmod +x ~/tailscale-keeper.sh

# ä½¿ç”¨ PM2 ç®¡ç†
pm2 start ~/tailscale-keeper.sh --name tailscale-keeper
pm2 save

# è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
```

---

## æ‰‹æœºç«¯é…ç½®

### 1. å®‰è£… Tailscale App

- **iOS**: App Store æœç´¢ "Tailscale"
- **Android**: Google Play æˆ–å®˜ç½‘ä¸‹è½½

### 2. ç™»å½•

ä½¿ç”¨**ä¸ç”µè„‘ç›¸åŒçš„è´¦å·**ç™»å½•ï¼ˆGitHub/Google/å¾®è½¯è´¦å·ï¼‰

### 3. éªŒè¯è¿æ¥

ç™»å½•åï¼Œä½ åº”è¯¥èƒ½åœ¨ App ä¸­çœ‹åˆ°ï¼š
- ä½ çš„ç”µè„‘åç§°
- ç”µè„‘åˆ†é…çš„ IPï¼ˆå¦‚ `100.x.x.x`ï¼‰
- è¿æ¥çŠ¶æ€æ˜¾ç¤ºä¸º "Connected"

---

## SSH è¿æ¥

### ä½¿ç”¨ iOS SSH å®¢æˆ·ç«¯

æ¨è Appï¼š
- **Termius**ï¼ˆå…è´¹ï¼Œæ¨èï¼‰
- **Prompt 2**ï¼ˆä»˜è´¹ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼‰
- **Blink Shell**ï¼ˆä»˜è´¹ï¼Œä¸“ä¸šçº§ï¼‰

**è¿æ¥é…ç½®ï¼š**

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| ä¸»æœº/åœ°å€ | `100.x.x.x`ï¼ˆä½ çš„ç”µè„‘ Tailscale IPï¼‰ |
| ç«¯å£ | `22` |
| ç”¨æˆ·å | `ä½ çš„ macOS ç”¨æˆ·å` |
| å¯†ç  | `ä½ çš„ macOS ç™»å½•å¯†ç ` |

æˆ–ä½¿ç”¨ **SSH å¯†é’¥**ï¼ˆæ›´å®‰å…¨ï¼‰ï¼š

```bash
# åœ¨ç”µè„‘ä¸Šç”Ÿæˆå¯†é’¥ï¼ˆå¦‚å°šæœªç”Ÿæˆï¼‰
ssh-keygen -t ed25519

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub
```

å°†ç§é’¥å¯¼å…¥æ‰‹æœº SSH Appï¼Œå³å¯å…å¯†ç ç™»å½•ã€‚

### æµ‹è¯•è¿æ¥

è¿æ¥æˆåŠŸåï¼Œè¯•è¯•è¿™äº›å‘½ä»¤ï¼š
```bash
whoami          # æ˜¾ç¤ºç”¨æˆ·å
hostname        # æ˜¾ç¤ºç”µè„‘å
pwd             # å½“å‰ç›®å½•
ls -la          # åˆ—å‡ºæ–‡ä»¶
```

---

## è¿›é˜¶ï¼šé…ç½® Exit Node

å¦‚æœä½ æƒ³è®©æ‰‹æœºæ‰€æœ‰æµé‡éƒ½ç»è¿‡ç”µè„‘ï¼ˆå®ç°"ç¿»å¢™"æˆ–ç»Ÿä¸€å‡ºå£ IPï¼‰ï¼Œå¯ä»¥é…ç½® Exit Nodeã€‚

### ç”µè„‘ç«¯é…ç½®

```bash
# å¼€å¯ Exit Node åŠŸèƒ½
sudo tailscale up --advertise-exit-node --accept-routes
```

### ç®¡ç†åå°æˆæƒ

1. è®¿é—® https://login.tailscale.com/admin/machines
2. æ‰¾åˆ°ä½ çš„ç”µè„‘ï¼Œç‚¹å‡»èœå• â†’ "Edit route settings..."
3. âœ… å‹¾é€‰ "Use as exit node" â†’ Save

### æ‰‹æœºç«¯å¯ç”¨

1. æ‰“å¼€ Tailscale App
2. ç‚¹å‡»ä½ çš„ç”µè„‘è®¾å¤‡
3. å¼€å¯ "Use as exit node"
4. éªŒè¯ï¼šè®¿é—® ip.sbï¼Œåº”æ˜¾ç¤ºç”µè„‘çš„å…¬ç½‘ IP

---

## å¸¸è§é—®é¢˜

### Q1: æ‰‹æœºè¿æ¥åæ˜¾ç¤º "offline"

**åŸå› ï¼š** iOS åå°é™åˆ¶ï¼Œé”å±å VPN å¯èƒ½è¢«æš‚åœ

**è§£å†³ï¼š** é‡æ–°æ‰“å¼€ Tailscale App å³å¯

### Q2: iOS æ— æ³•åŒæ—¶è¿è¡Œ Tailscale å’Œå…¶ä»– VPN

**åŸå› ï¼š** iOS é™åˆ¶åªèƒ½æœ‰ä¸€ä¸ª VPN éš§é“

**è§£å†³ï¼š**
- ä½¿ç”¨ Exit Node åŠŸèƒ½ï¼ˆè®© Tailscale å…¼ä»»ç¿»å¢™ï¼‰
- æˆ–æŒ‰éœ€åˆ‡æ¢ VPN

### Q3: è¿æ¥æˆåŠŸä½† SSH å¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# åœ¨ç”µè„‘ä¸Šæ£€æŸ¥ SSH æœåŠ¡
sudo lsof -i :22

# æ£€æŸ¥ Tailscale çŠ¶æ€
tailscale status

# æ£€æŸ¥é˜²ç«å¢™
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
```

### Q4: ç”µè„‘é‡å¯å Tailscale æ²¡è‡ªåŠ¨è¿æ¥

**è§£å†³ï¼š**
```bash
# æ‰‹åŠ¨å¯åŠ¨
tailscale up

# æˆ–ä½¿ç”¨ PM2 è‡ªåŠ¨æ¢å¤
pm2 resurrect
```

### Q5: Tailscale IP ä¼šå˜å—ï¼Ÿ

**ä¸ä¼šã€‚** åªè¦è®¾å¤‡ä¸è¢«åˆ é™¤ï¼Œåˆ†é…çš„ `100.x.x.x` IP æ˜¯å›ºå®šçš„ã€‚

---

## ğŸ“ é™„å½•

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
tailscale status
tailscale status --json

# æŸ¥çœ‹æœ¬æœº IP
tailscale ip -4

# åœæ­¢/å¯åŠ¨
tailscale down
tailscale up

# æŸ¥çœ‹ç½‘ç»œè·¯å¾„ï¼ˆåˆ¤æ–­æ˜¯å¦ç›´è¿ï¼‰
tailscale status | grep -E "direct|relay"
```

### å®‰å…¨å»ºè®®

1. **å¯ç”¨è®¾å¤‡å®¡æ‰¹**ï¼šåœ¨ Tailscale ç®¡ç†åå°å¼€å¯ "Device approval"ï¼Œæ–°è®¾å¤‡éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†
2. **ä½¿ç”¨ ACL**ï¼šé™åˆ¶è®¾å¤‡é—´çš„è®¿é—®æƒé™
3. **å®šæœŸè½®æ¢å¯†é’¥**ï¼šTailscale ä¼šè‡ªåŠ¨å¤„ç†
4. **ç¦ç”¨ä¸ç”¨çš„è®¾å¤‡**ï¼šåŠæ—¶åœ¨åå°ç§»é™¤ä¸¢å¤±æˆ–ä¸å†ä½¿ç”¨çš„è®¾å¤‡

---

## å‚è€ƒé“¾æ¥

- [Tailscale å®˜ç½‘](https://tailscale.com)
- [WireGuard åè®®](https://www.wireguard.com/)
- [macOS è¿œç¨‹ç™»å½•å®˜æ–¹æ–‡æ¡£](https://support.apple.com/guide/mac-help/allow-a-remote-computer-to-access-your-mac-mchlp1066/mac)

---

**ä½œè€…ï¼š** @ruska  
**åˆ›å»ºæ—¶é—´ï¼š** 2026-02-20  
**é€‚ç”¨å¹³å°ï¼š** macOS + iOS/Android
